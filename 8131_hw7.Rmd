---
title: "P8131_HW7"
output: pdf_document
date: "2023-04-11"
author: "Zirui Zhang (zz3039)"
---

```{r chunk_setup, message=FALSE}
library(readr)
library(tidyverse)
library(dplyr)
library(nlme)
library(lme4)
```

### Question (a)

```{r chunk_qa, message=FALSE, warning=FALSE}
# load data
pl = read.csv("./HW7-politeness_data.csv") 
attach(pl)
# boxplot
boxplot(frequency~gender, xlab="gender", ylab="pitch")
boxplot(frequency~attitude, xlab="attitude", ylab="pitch")
```

### Question (b)

```{r}
# fit LMM with random intercept
lmm1 = lme(frequency ~ gender+attitude, random=~1 | subject, data=pl, method="REML" )
summary(lmm1)
# covariance matrix for a subject Yi
var_b = as.numeric(VarCorr(lmm1)[1])
var = as.numeric(VarCorr(lmm1)[2])
covy = matrix(var_b, ncol = 7, nrow = 7) 
diag(covy)= var_b + var
covy
# covariance matrix for estimates of fixed effects
vcov(lmm1)
# BLUPs for subject-specific intercepts
random.effects(lmm1)
# residuals
pl$frequency-fitted(lmm1)
```

### Question (c)

```{r}
lmm2.1 = lme(frequency ~ gender+attitude, random=~1|subject, data=pl, method="ML" )
lmm2.2 = lme(frequency ~ gender+attitude+gender*attitude, random=~1|subject, data=pl, method="ML" )
anova(lmm2.1, lmm2.2)
```

The P-value is greater than 0.05, thus we fail to reject the null and use the smaller model without the interaction term.